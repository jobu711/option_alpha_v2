{% extends "base.html" %}

{% block title %}Settings - Option Alpha{% endblock %}

{% block content %}
<div class="settings-page">
    <div class="settings-header">
        <h1>Settings</h1>
        <p class="settings-subtitle">Configure scoring weights, filters, and AI backend.</p>
    </div>

    <!-- Success/Error message target -->
    <div id="settings-message"></div>

    <form hx-post="/settings" hx-target="#settings-message" hx-swap="innerHTML">
        <!-- Scoring Weights -->
        <section class="settings-section">
            <h2>Scoring Weights</h2>
            <p class="section-desc">Adjust the relative weight of each technical indicator in the composite score. Values should be between 0 and 1.</p>
            <div class="settings-grid">
                {% for key, value in weights.items() %}
                <div class="form-group">
                    <label for="weight_{{ key }}">{{ key | replace("_", " ") | title }}</label>
                    <input type="number" id="weight_{{ key }}" name="weight_{{ key }}"
                           value="{{ '%.2f'|format(value) }}" min="0" max="1" step="0.01"
                           class="form-input mono">
                </div>
                {% endfor %}
            </div>
        </section>

        <!-- Filters -->
        <section class="settings-section">
            <h2>Filters</h2>
            <p class="section-desc">Set minimum thresholds for ticker screening.</p>
            <div class="settings-grid">
                <div class="form-group">
                    <label for="min_composite_score">Min Composite Score</label>
                    <input type="number" id="min_composite_score" name="min_composite_score"
                           value="{{ '%.1f'|format(config.min_composite_score) }}" min="0" max="100" step="0.1"
                           class="form-input mono">
                </div>
                <div class="form-group">
                    <label for="min_price">Min Price ($)</label>
                    <input type="number" id="min_price" name="min_price"
                           value="{{ '%.2f'|format(config.min_price) }}" min="0" step="0.01"
                           class="form-input mono">
                </div>
                <div class="form-group">
                    <label for="min_avg_volume">Min Avg Volume</label>
                    <input type="number" id="min_avg_volume" name="min_avg_volume"
                           value="{{ config.min_avg_volume }}" min="0" step="1000"
                           class="form-input mono">
                </div>
            </div>
        </section>

        <!-- Options Parameters -->
        <section class="settings-section">
            <h2>Options Parameters</h2>
            <p class="section-desc">Configure options chain filtering and DTE range.</p>
            <div class="settings-grid">
                <div class="form-group">
                    <label for="dte_min">DTE Min (days)</label>
                    <input type="number" id="dte_min" name="dte_min"
                           value="{{ config.dte_min }}" min="1" step="1"
                           class="form-input mono">
                </div>
                <div class="form-group">
                    <label for="dte_max">DTE Max (days)</label>
                    <input type="number" id="dte_max" name="dte_max"
                           value="{{ config.dte_max }}" min="1" step="1"
                           class="form-input mono">
                </div>
                <div class="form-group">
                    <label for="min_open_interest">Min Open Interest</label>
                    <input type="number" id="min_open_interest" name="min_open_interest"
                           value="{{ config.min_open_interest }}" min="0" step="1"
                           class="form-input mono">
                </div>
                <div class="form-group">
                    <label for="max_bid_ask_spread_pct">Max Bid-Ask Spread (%)</label>
                    <input type="number" id="max_bid_ask_spread_pct" name="max_bid_ask_spread_pct"
                           value="{{ '%.2f'|format(config.max_bid_ask_spread_pct) }}" min="0" max="1" step="0.01"
                           class="form-input mono">
                </div>
                <div class="form-group">
                    <label for="min_option_volume">Min Option Volume</label>
                    <input type="number" id="min_option_volume" name="min_option_volume"
                           value="{{ config.min_option_volume }}" min="0" step="1"
                           class="form-input mono">
                </div>
            </div>
        </section>

        <!-- AI Configuration -->
        <section class="settings-section">
            <h2>AI Configuration</h2>
            <p class="section-desc">Choose AI backend and configure model parameters.</p>
            <div class="settings-grid">
                <div class="form-group form-group-wide">
                    <label>AI Backend</label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="ai_backend" value="ollama"
                                   {% if config.ai_backend == "ollama" %}checked{% endif %}>
                            <span>Ollama (Local)</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="ai_backend" value="claude"
                                   {% if config.ai_backend == "claude" %}checked{% endif %}>
                            <span>Claude (API)</span>
                        </label>
                    </div>
                </div>
                <div class="form-group">
                    <label for="ollama_model">Ollama Model</label>
                    <input type="text" id="ollama_model" name="ollama_model"
                           value="{{ config.ollama_model }}"
                           class="form-input mono">
                </div>
                <div class="form-group">
                    <label for="claude_api_key">Claude API Key</label>
                    <input type="password" id="claude_api_key" name="claude_api_key"
                           value="" placeholder="{{ masked_claude_key }}"
                           class="form-input mono">
                    <span class="form-hint">Leave blank to keep current key.</span>
                </div>
            </div>
        </section>

        <!-- FRED API -->
        <section class="settings-section">
            <h2>FRED API</h2>
            <p class="section-desc">Federal Reserve Economic Data API key for risk-free rate lookups.</p>
            <div class="settings-grid">
                <div class="form-group">
                    <label for="fred_api_key">FRED API Key</label>
                    <input type="password" id="fred_api_key" name="fred_api_key"
                           value="" placeholder="{{ masked_fred_key }}"
                           class="form-input mono">
                    <span class="form-hint">Leave blank to keep current key.</span>
                </div>
            </div>
        </section>

        <!-- Actions -->
        <div class="settings-actions">
            <button type="submit" class="btn btn-primary">Save Settings</button>
            <button type="button" class="btn btn-secondary"
                    hx-post="/settings/reset"
                    hx-target="body"
                    hx-confirm="Reset all settings to defaults? This cannot be undone.">
                Reset to Defaults
            </button>
        </div>
    </form>
</div>
{% endblock %}
