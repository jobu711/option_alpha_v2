---
name: Relax determine_direction to reduce false neutrals
status: open
created: 2026-02-11T22:04:49Z
updated: 2026-02-11T22:20:13Z
github: https://github.com/jobu711/option_alpha_v2/issues/46
depends_on: [42, 44]
parallel: false
conflicts_with: [48]
---

# Task: Relax determine_direction to reduce false neutrals

## Description
`determine_direction()` in `composite.py` requires BOTH RSI and SMA alignment to agree for a non-neutral classification. This is overly strict — a stock with RSI=70 and SMA20 > SMA50 (but no SMA200 data) should be classified BULLISH, not NEUTRAL. Relax the logic to allow RSI-only signals when SMA is neutral but RSI is decisive.

## Acceptance Criteria
- [ ] RSI > 50 + SMA bullish → BULLISH (unchanged)
- [ ] RSI < 50 + SMA bearish → BEARISH (unchanged)
- [ ] RSI > 60 + SMA neutral → BULLISH (new: RSI-only signal for strong momentum)
- [ ] RSI < 40 + SMA neutral → BEARISH (new: RSI-only signal for strong momentum)
- [ ] RSI 40-60 + SMA neutral → NEUTRAL (ambiguous, stay neutral)
- [ ] Configurable RSI thresholds added to Settings: `direction_rsi_strong_bullish` (default 60), `direction_rsi_strong_bearish` (default 40)
- [ ] All existing tests pass; new tests cover the relaxed logic

## Technical Details
- **config.py**: Add two new settings:
  - `direction_rsi_strong_bullish: float = 60.0`
  - `direction_rsi_strong_bearish: float = 40.0`
- **composite.py** (lines 67-84, `determine_direction()`):
  - Accept optional `settings` parameter
  - After existing RSI+SMA checks, add RSI-only fallback:
    ```python
    # RSI-only signal when SMA is neutral but RSI is decisive
    if rsi_val > settings.direction_rsi_strong_bullish:
        return Direction.BULLISH
    elif rsi_val < settings.direction_rsi_strong_bearish:
        return Direction.BEARISH
    return Direction.NEUTRAL
    ```
- **composite.py** (`score_universe()`): Pass settings to `determine_direction(df, settings=settings)`

## Dependencies
- [ ] Task 42 (config changes) — new settings fields
- [ ] Task 44 (SMA direction fix) — `sma_direction()` now returns meaningful values for 50-200 bar data

## Effort Estimate
- Size: S
- Hours: 1-2
- Parallel: false (on critical path)

## Definition of Done
- [ ] `determine_direction()` produces non-neutral results for strong RSI signals
- [ ] New config thresholds are respected
- [ ] New unit tests validate all direction classification branches
- [ ] All existing tests pass
