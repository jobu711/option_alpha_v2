---
name: Replace indicator interpretation with data-driven thresholds
status: open
created: 2026-02-13T15:16:40Z
updated: 2026-02-13T15:26:14Z
github: https://github.com/jobu711/option_alpha_v2/issues/66
depends_on: []
parallel: true
conflicts_with: [68]
---

# Task: Replace indicator interpretation with data-driven thresholds

## Description
Replace the 100-line `_interpret_indicator()` if/elif chain in `context.py` with a `INDICATOR_THRESHOLDS` dict lookup table. Adding a new indicator should require only adding a dict entry. All existing interpretations must remain identical (backward compatible).

## Acceptance Criteria
- [ ] `INDICATOR_THRESHOLDS` dict defined at module level in `context.py`
- [ ] Each entry maps indicator name → list of `(threshold, label)` tuples, evaluated in order
- [ ] `_interpret_indicator()` reduced to <30 lines using the lookup table
- [ ] Unknown indicators return the raw value formatted as a string (no KeyError)
- [ ] NaN values still return `"N/A"`
- [ ] All existing indicator interpretations produce identical output (ADX, RSI, Stoch RSI, Williams %R, ROC, Relative Volume, BB/Keltner Width, SMA Alignment, Supertrend, VWAP Deviation, OBV/AD Trend, ATR %)
- [ ] Existing tests pass unchanged (TestInterpretIndicator)

## Technical Details

### context.py — INDICATOR_THRESHOLDS (~top of file, after imports)

Structure: Each indicator maps to a list of `(comparator_fn, label)` or simpler `(threshold, label)` tuples checked in order. For most indicators, "first threshold exceeded" works:

```python
INDICATOR_THRESHOLDS: dict[str, list[tuple[float, str]]] = {
    "adx": [(75, "Extreme trend strength"), (50, "Strong trend"), (25, "Moderate trend"), (20, "Developing trend"), (float("-inf"), "Weak/No trend")],
    "rsi": [(70, "Overbought"), (50, "Bullish momentum"), (30, "Bearish momentum"), (float("-inf"), "Oversold")],
    "stoch_rsi": [(80, "Overbought"), (20, "Neutral"), (float("-inf"), "Oversold")],
    # ... etc
}
```

Special cases that need custom handling (not simple threshold comparison):
- **Supertrend**: Binary (>=0 bullish, <0 bearish)
- **VWAP Deviation**: Three ranges (>1 above, <-1 below, else near)
- **OBV/AD Trend**: Three values (>0, <0, ==0)
- **ATR %**: Formatted as percentage string

These can use a separate `INDICATOR_FORMATTERS` dict with callables for non-threshold indicators.

### context.py — _interpret_indicator() (~line 16-116)

New implementation:
```python
def _interpret_indicator(name: str, value: float) -> str:
    if pd.isna(value):
        return "N/A"
    # Check formatters first (special cases)
    if name in INDICATOR_FORMATTERS:
        return INDICATOR_FORMATTERS[name](value)
    # Check threshold table
    if name in INDICATOR_THRESHOLDS:
        for threshold, label in INDICATOR_THRESHOLDS[name]:
            if value >= threshold:
                return f"{value:.1f} ({label})"
        return f"{value:.1f}"
    # Unknown indicator
    return f"{value:.2f}"
```

## Dependencies
- None (context.py is independent of config/model changes)

## Effort Estimate
- Size: M
- Hours: 2-3
- Parallel: true (independent of tasks 1-5; conflicts with 007 on context.py)

## Definition of Done
- [ ] Code implemented
- [ ] All TestInterpretIndicator tests pass unchanged
- [ ] New indicator can be added with a single dict entry
- [ ] Existing tests pass
