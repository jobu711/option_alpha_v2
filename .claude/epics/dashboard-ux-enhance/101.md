---
name: Add scan ETA estimation and display
status: open
created: 2026-02-14T13:19:45Z
updated: 2026-02-14T13:26:09Z
github: https://github.com/jobu711/option_alpha_v2/issues/101
depends_on: []
parallel: true
conflicts_with: []
---

# Task: Add scan ETA estimation and display

## Description
Add estimated time remaining to the scan progress display. After the first phase completes, calculate ETA from elapsed time and percentage, then display "~X min remaining" below the progress bar. The estimate refines as each phase completes.

## Acceptance Criteria
- [ ] `ScanProgress` model has `eta_seconds: float | None = None` field
- [ ] `ScanProgress` model has `ticker_count: int = 0` field for "Scanning N tickers" display
- [ ] After first phase completes (percentage > 0), ETA is calculated: `remaining = (elapsed / pct) * (100 - pct)`
- [ ] ETA updates on each phase completion (refines as more data is available)
- [ ] `_progress.html` displays ETA below the progress bar (e.g., "~2 min remaining")
- [ ] If percentage is 0 or scan just started, show "Estimating..." instead of a number
- [ ] ETA is transmitted via existing WebSocket progress channel (no additional messages)
- [ ] ETA does not add latency to the scan pipeline (calculated inline, no DB queries)

## Technical Details

**Files to modify:**

- `src/option_alpha/pipeline/progress.py`:
  - Add to `ScanProgress` model:
    ```python
    eta_seconds: float | None = None
    ticker_count: int = 0
    ```
  - These auto-serialize via `model_dump()` in the existing WebSocket broadcast

- `src/option_alpha/pipeline/orchestrator.py`:
  - After updating `overall_percentage` and `elapsed_total` in progress callbacks, calculate ETA:
    ```python
    if progress.overall_percentage > 5:  # Wait for meaningful data
        rate = progress.elapsed_total / progress.overall_percentage
        progress.eta_seconds = rate * (100 - progress.overall_percentage)
    else:
        progress.eta_seconds = None
    ```
  - Set `progress.ticker_count = len(universe)` after universe resolution

- `src/option_alpha/web/templates/_progress.html`:
  - Add ETA display after the progress bar:
    ```html
    <div class="progress-footer">
      {% if ticker_count %}
        <span class="progress-scope">Scanning {{ ticker_count }} tickers</span>
      {% endif %}
      {% if eta_seconds is not none and eta_seconds > 0 %}
        <span class="progress-eta">~{{ (eta_seconds / 60) | round(0) | int }} min remaining</span>
      {% elif overall_percentage > 0 %}
        <span class="progress-eta">Estimating...</span>
      {% endif %}
    </div>
    ```

- `src/option_alpha/web/static/style.css`:
  - `.progress-footer` — flex, justify-content: space-between, margin-top: 0.5rem
  - `.progress-eta` — muted text color, font-size 0.85rem
  - `.progress-scope` — muted text, font-size 0.85rem

**Key considerations:**
- ETA calculation is simple division — no new DB tables or historical data needed
- The extrapolation works best when phases have roughly equal duration; it may be inaccurate early but improves as phases complete
- For very fast scans (< 30 seconds), ETA might show "< 1 min" — format accordingly with `max(eta_seconds, 0)`
- The `ticker_count` field is also useful for Task 6 (subset scanning) to show "Scanning 15 of 200 tickers"

## Dependencies
- [ ] None — fully independent task

## Effort Estimate
- Size: S
- Parallel: true
