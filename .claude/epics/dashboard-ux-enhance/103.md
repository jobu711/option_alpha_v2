---
name: Implement advanced universe filtering
status: open
created: 2026-02-14T13:19:45Z
updated: 2026-02-14T13:26:09Z
github: https://github.com/jobu711/option_alpha_v2/issues/103
depends_on: []
parallel: true
conflicts_with: []
---

# Task: Implement advanced universe filtering

## Description
Add a multi-filter bar to the universe page that lets users filter the ticker table by sector, tag, active status, and last-scanned date. Filters combine with AND logic, update the table via HTMX without page reload, show an active filter count badge, and preserve state during pagination.

## Acceptance Criteria
- [ ] Filter bar renders above the ticker table with dropdowns for: Sector, Tag, Status (Active/Inactive/All), Last Scanned (Today/This Week/This Month/Never/All)
- [ ] Sector dropdown populated dynamically from `GET /api/universe/sectors`
- [ ] Tag dropdown populated from existing tag list
- [ ] Filters combine with AND logic and update the ticker table via HTMX
- [ ] Active filter count shown as a badge (e.g., "Filters (2)")
- [ ] "Clear all filters" button resets all dropdowns and refreshes the table
- [ ] Filter state preserved during pagination (filter params included in pagination URLs)
- [ ] Filtering responds in < 200ms

## Technical Details

**Files to modify:**
- `src/option_alpha/web/universe_routes.py`:
  - Add `sector: str | None = Query(default=None)` param to `list_tickers()` (around line 134)
  - Add `last_scanned: str | None = Query(default=None)` param with values: "today", "week", "month", "never"
  - Extend WHERE clause (lines 148-171) with:
    - `if sector: conditions.append("ut.sector = ?"); params.append(sector)`
    - `if last_scanned == "today": conditions.append("ut.last_scanned_at >= date('now')")`
    - `if last_scanned == "week": conditions.append("ut.last_scanned_at >= date('now', '-7 days')")`
    - `if last_scanned == "month": conditions.append("ut.last_scanned_at >= date('now', '-30 days')")`
    - `if last_scanned == "never": conditions.append("ut.last_scanned_at IS NULL")`
  - Add new endpoint: `GET /api/universe/sectors` returning distinct sector values as JSON
  - Include current filter params in pagination URL generation so filters persist across pages

- `src/option_alpha/web/templates/universe/universe.html`:
  - Add filter bar HTML between toolbar and ticker table
  - Each dropdown uses `hx-get="/api/universe/tickers"` with `hx-include=".filter-bar"` to send all filter values
  - `hx-trigger="change"` on each dropdown
  - Filter count badge updates via JS (count non-default dropdowns)
  - "Clear all" button resets dropdowns and triggers table refresh

- `src/option_alpha/web/static/style.css`:
  - `.filter-bar` — horizontal flex row, gap between dropdowns
  - `.filter-badge` — small pill with count
  - Style dropdowns to match dark theme (custom select styling)

**Key considerations:**
- Pagination links must include all active filter params as query strings
- The existing `tag` and `active` params already work; `sector` and `last_scanned` extend the same pattern
- Use `hx-include` on the filter bar container so all filter values are sent together

## Dependencies
- [ ] None — extends existing filtering pattern

## Effort Estimate
- Size: M
- Parallel: true
