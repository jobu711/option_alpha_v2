---
name: Fix tag sidebar display and HTMX swap
status: open
created: 2026-02-14T13:19:45Z
updated: 2026-02-14T13:26:09Z
github: https://github.com/jobu711/option_alpha_v2/issues/100
depends_on: []
parallel: true
conflicts_with: []
---

# Task: Fix tag sidebar display and HTMX swap

## Description
The tag sidebar in the universe page has two issues: (1) active/inactive tag indicators render as raw `●`/`○` HTML entities instead of styled elements, and (2) toggling a tag replaces the entire sidebar via `hx-target="#tag-sidebar"`, causing scroll jumps and state loss. Fix both by replacing HTML entities with CSS-styled dots and changing the HTMX swap to target only the individual `.tag-item` being toggled.

## Acceptance Criteria
- [ ] Active tags show a green CSS dot, inactive tags show a gray CSS dot (no raw `●`/`○` characters)
- [ ] Tag toggle button uses `hx-target="closest .tag-item"` with `hx-swap="outerHTML"` to swap only the clicked tag
- [ ] Backend `PATCH /api/universe/tags/{slug}` returns a single `_tag_item.html` partial (or inline tag-item div) instead of the full sidebar
- [ ] Tag toggle does not cause sidebar scroll jump or flash
- [ ] Tag count next to each tag name updates correctly after toggle
- [ ] Ticker count header (if present, from Task 2) updates via OOB swap on tag toggle

## Technical Details

**Files to modify:**
- `src/option_alpha/web/templates/universe/_tag_sidebar.html` — Replace `{{ "&#9679;" if tag.is_active else "&#9675;" }}` with `<span class="tag-dot tag-dot--active"></span>` / `<span class="tag-dot tag-dot--inactive"></span>`; change `hx-target="#tag-sidebar"` to `hx-target="closest .tag-item"` and `hx-swap="outerHTML"`
- `src/option_alpha/web/universe_routes.py` — Update `PATCH /api/universe/tags/{slug}` handler (around line 460) to return a single tag-item HTML fragment instead of the full `_tag_sidebar.html` partial. Could use an inline Jinja2 render or extract a `_tag_item.html` partial.
- `src/option_alpha/web/static/style.css` — Add `.tag-dot` styles: inline-block, 8px circle, green (#22c55e) for active, gray (#666) for inactive

**Key considerations:**
- The tag-item fragment must include the same `hx-patch`, `hx-target`, `hx-swap`, and `hx-vals` attributes so subsequent toggles still work (self-replacing pattern)
- Test with multiple rapid toggles to ensure no race conditions
- Preserve the tag-name click behavior (filters ticker table by tag)

## Dependencies
- [ ] None — this is an independent task

## Effort Estimate
- Size: S
- Parallel: true
