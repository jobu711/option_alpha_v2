---
name: Validate full test suite and clean up
status: open
created: 2026-02-13T14:33:53Z
updated: 2026-02-13T14:36:49Z
github: https://github.com/jobu711/option_alpha_v2/issues/83
depends_on: [82]
parallel: false
conflicts_with: []
---

# Task: Validate full test suite and clean up

## Description

Run the complete test suite (`pytest tests/`) to verify zero regressions across all 925+ tests. Fix any failures caused by the AI module rewrite (e.g., import changes, removed functions referenced elsewhere). Verify no raw httpx or `_extract_json_from_text` references remain in the AI module.

## Acceptance Criteria

- [ ] `pytest tests/` passes with 0 failures (excluding the known Ollama-running env test)
- [ ] No references to `_extract_json_from_text` or `_parse_structured_output` in any source file
- [ ] No raw `httpx` imports in `src/option_alpha/ai/` (except if needed by SDK internals)
- [ ] No `instructor` imports anywhere in the codebase
- [ ] `src/option_alpha/ai/context.py` is unmodified (git diff shows no changes)
- [ ] `src/option_alpha/models.py` is unmodified
- [ ] `src/option_alpha/pipeline/orchestrator.py` is unmodified
- [ ] AI module total LOC is ≤ current (~1350 lines)

## Technical Details

### Validation steps

1. **Run full test suite**
   ```bash
   pytest tests/ -v
   ```

2. **Check for stale references**
   ```bash
   grep -r "_extract_json_from_text" src/
   grep -r "_parse_structured_output" src/
   grep -r "import instructor" src/
   grep -r "import httpx" src/option_alpha/ai/
   ```

3. **Verify unchanged files**
   ```bash
   git diff src/option_alpha/ai/context.py
   git diff src/option_alpha/models.py
   git diff src/option_alpha/pipeline/orchestrator.py
   ```

4. **LOC check**
   ```bash
   wc -l src/option_alpha/ai/clients.py src/option_alpha/ai/agents.py src/option_alpha/ai/debate.py
   ```

### Common regression points
- `orchestrator.py` imports `get_client` from `ai.clients` and `DebateManager` from `ai.debate` — verify these still exist
- `orchestrator.py` sets `client.timeout = effective["ai_request_timeout"]` — verify `timeout` attribute exists
- Other test files may mock AI functions — check for broken mocks
- `web/` routes may reference AI models — should be fine since models.py is unchanged

### Files affected
- None modified — this is validation only
- Fix any files that have regressions

## Dependencies

- [ ] Task 82 (AI tests passing)

## Effort Estimate

- Size: S
- Hours: 1
- Parallel: false (final validation)

## Definition of Done

- [ ] Full test suite passing
- [ ] No stale references
- [ ] Unchanged files verified
- [ ] LOC target met
