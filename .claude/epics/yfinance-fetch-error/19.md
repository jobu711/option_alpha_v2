---
name: Implement failure cache functions
status: closed
created: 2026-02-11T13:44:14Z
updated: 2026-02-11T13:44:14Z
github: https://github.com/jobu711/option_alpha_v2/issues/19
depends_on: [18]
parallel: true
conflicts_with: []
---

# Task: Implement failure cache functions

## Description
Add 4 failure cache functions to `cache.py`: `load_failure_cache`, `record_failures`, `clear_failure_cache`, and `get_failure_cache_stats`. Uses a JSON file at `data/cache/_failures.json` with TTL-based eviction and corruption resilience.

## Acceptance Criteria
- [ ] `load_failure_cache(ttl_hours)` returns dict of ticker → failure entry, evicting expired entries
- [ ] `record_failures(failures)` appends/updates failure entries in the cache file
- [ ] `clear_failure_cache()` deletes the cache file
- [ ] `get_failure_cache_stats()` returns summary dict (count, by-type breakdown, oldest entry)
- [ ] All I/O wrapped in try/except — corruption never blocks scans
- [ ] Cache file uses fixed filename `_failures.json` (not date-based)
- [ ] Failure entries include: ticker, error_type (FetchErrorType), timestamp, message
- [ ] All existing tests pass

## Technical Details
- File: `src/option_alpha/data/cache.py`
- Place new functions after existing `clear_cache` function
- Import `FetchErrorType` from `models.py` (depends on #18)
- JSON structure: `{"TICKER": {"error_type": "DELISTED", "timestamp": "ISO8601", "message": "..."}}`
- TTL check: compare entry timestamp against `datetime.utcnow() - timedelta(hours=ttl_hours)`
- Handle: missing file, empty file, corrupt JSON, permission errors

## Dependencies
- [ ] #18 (FetchErrorType enum must exist)

## Effort Estimate
- Size: M
- Hours: 2-3
- Parallel: true (can run alongside #14 after #18 completes)

## Definition of Done
- [ ] Code implemented
- [ ] Tests written and passing
- [ ] Existing 547+ tests still pass
