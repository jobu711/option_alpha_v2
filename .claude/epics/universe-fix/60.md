---
name: Add OI validation to universe refresh
status: open
created: 2026-02-12T13:08:06Z
updated: 2026-02-12T13:15:04Z
github: https://github.com/jobu711/option_alpha_v2/issues/60
depends_on: [57]
parallel: false
conflicts_with: [61, 56]
---

# Task: Add OI validation to universe refresh

## Description
Implement open interest validation in `universe_refresh.py`. Add a new `_validate_open_interest()` function that checks each stock ticker's total OI across its nearest options expiration and filters out tickers below the configured threshold. ETFs are exempt from this check. Integrate this step into the `_do_refresh()` pipeline between the optionability check and metadata enrichment.

## Acceptance Criteria
- [ ] New `_validate_open_interest(tickers, settings) -> list[str]` function added to `universe_refresh.py`
- [ ] For each ticker: fetches options chain via `yf.Ticker(symbol).option_chain(nearest_expiry)`, sums `openInterest` column across calls and puts
- [ ] Tickers with total OI below `settings.min_universe_oi` are excluded
- [ ] Rate limiting between yfinance calls (~2 seconds between individual ticker lookups, ~1800 req/hr)
- [ ] Per-ticker logging: pass/fail with OI value and reason
- [ ] ETF tickers are identified and skipped (passed through without OI check)
- [ ] `_do_refresh()` calls `_validate_open_interest()` after `_validate_optionability()` and before `_enrich_metadata()`
- [ ] The function accepts a settings parameter to read `min_universe_oi` threshold

## Technical Details
- File: `src/option_alpha/data/universe_refresh.py`
- ETF detection: during the optionability check, also check `yf.Ticker(symbol).info.get("quoteType")` == "ETF", or pass a known ETF list
- For efficiency, use the nearest expiration date only (first element of `t.options` tuple) rather than summing all expirations
- Rate limiting: `time.sleep(2)` between individual ticker OI checks; log progress every 50 tickers
- Handle exceptions gracefully: if OI check fails for a ticker, exclude it (fail-closed)
- The existing `_validate_optionability()` already iterates per-ticker; consider combining or keeping separate for clarity

## Dependencies
- [ ] Task 57 (config settings must exist)

## Effort Estimate
- Size: M
- Hours: 4
- Parallel: false (core logic that tasks 3 and 4 build on)

## Definition of Done
- [ ] Code implemented
- [ ] OI validation integrated into refresh pipeline
- [ ] Rate limiting in place
- [ ] Per-ticker logging works
- [ ] ETFs pass through without OI check
