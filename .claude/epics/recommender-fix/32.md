---
name: Update AI test to verify example-based hint format
status: open
created: 2026-02-11T16:29:26Z
updated: 2026-02-11T16:32:44Z
github: https://github.com/jobu711/option_alpha_v2/issues/32
depends_on: [31]
parallel: false
conflicts_with: [31]
---

# Task: Update AI test to verify example-based hint format

## Description
Update `TestOllamaClientRequest.test_complete_structured_output` in `tests/test_ai.py` to verify that the Ollama structured output prompt uses a concrete JSON example (not an abstract schema dump). Optionally add a direct unit test for `_build_example_hint()`.

## Acceptance Criteria
- [ ] Existing `test_complete_structured_output` updated to assert the prompt hint format
- [ ] Test verifies hint does NOT contain schema keys: `"description"`, `"properties"`, `"type": "object"`
- [ ] Test verifies hint contains a concrete JSON example with field names from the response model
- [ ] Optional: unit test for `_build_example_hint()` verifying output for `AgentResponse` and `TradeThesis`
- [ ] All tests pass

## Technical Details
- **File:** `tests/test_ai.py`
- **Modify:** `TestOllamaClientRequest.test_complete_structured_output` (line ~900)
  - After calling `client.complete()`, inspect the payload sent to `mock_ctx.post`
  - Extract the last message's content from the payload
  - Assert the hint portion does NOT contain `'"description"'` or `'"properties"'`
  - Assert it contains `"example"` or a recognizable field name like `"role"` or `"analysis"`
- **Optional addition:** `TestBuildExampleHint` class with tests for:
  - `_build_example_hint(AgentResponse)` produces valid JSON with expected keys
  - `_build_example_hint(TradeThesis)` produces valid JSON with expected keys
  - Output does not contain schema metadata

## Dependencies
- [ ] Task 31 must be complete (the helper function must exist)

## Effort Estimate
- Size: XS
- Hours: 0.5
- Parallel: false (depends on 31)

## Definition of Done
- [ ] Tests updated and passing
- [ ] Hint format validated in test assertions
