---
name: Web UI universe controls and watchlist management
status: open
created: 2026-02-11T14:35:48Z
updated: 2026-02-11T14:41:55Z
github: https://github.com/jobu711/option_alpha_v2/issues/23
depends_on: [27, 28, 22]
parallel: false
conflicts_with: []
---

# Task: Web UI universe controls and watchlist management

## Description

Add universe management UI to the web dashboard and settings page. The dashboard gets a preset selector (multi-select chips), sector filter chips, scan time estimate, and universe health stats. The settings page gets watchlist CRUD management and a manual universe refresh button. New API routes support all interactions via HTMX.

## Acceptance Criteria

- [ ] Dashboard: universe preset multi-select chips (S&P 500, Mid-Cap, Small-Cap, ETFs, Full) above scan button
- [ ] Dashboard: sector filter chips/checkboxes for 11 GICS sectors
- [ ] Dashboard: scan time estimate text updates when preset/sector selection changes (e.g., "~500 tickers, est. 3 min")
- [ ] Dashboard: universe health stats bar (total tickers, post-filter count, cache hit %, last refresh date)
- [ ] Dashboard: quick-add text input to paste tickers for current scan only
- [ ] Settings: watchlist management section — create, edit, delete named watchlists
- [ ] Settings: set active watchlist dropdown
- [ ] Settings: manual universe refresh button with loading state and result display
- [ ] API: `GET /api/universe/stats` returns universe size, preset counts, cache stats, refresh date
- [ ] API: `POST /api/universe/refresh` triggers refresh, returns result
- [ ] API: `GET /api/watchlists` returns all watchlists
- [ ] API: `POST /api/watchlists` creates/updates a watchlist
- [ ] API: `DELETE /api/watchlists/{name}` deletes a watchlist
- [ ] API: `POST /api/scan/config` updates preset/sector selection (persists to config)
- [ ] Preset/sector selection persists across page reloads

## Technical Details

**Files to modify:**
- `src/option_alpha/web/routes.py` — Add 6 new route handlers
- `src/option_alpha/web/templates/dashboard.html` — Add universe selector section
- `src/option_alpha/web/templates/settings.html` — Add watchlist management section

**Dashboard universe selector (HTMX pattern):**
```html
<!-- Universe Presets -->
<div class="universe-presets">
  <label>Universe:</label>
  <button class="chip" hx-post="/api/scan/config" ...>S&P 500</button>
  <button class="chip" hx-post="/api/scan/config" ...>Mid-Cap</button>
  ...
</div>

<!-- Sector Filters -->
<div class="sector-filters">
  <label>Sectors:</label>
  <button class="chip" ...>Technology</button>
  ...
</div>

<!-- Scan estimate -->
<span id="scan-estimate">~3,000 tickers, est. 15 min</span>
```

**Scan time estimation formula:**
- Base: ~5 seconds per ticker for uncached fetch
- Cached: ~0.1 seconds per ticker
- Estimate: `(uncached * 5 + cached * 0.1) / 60` minutes
- Simplified: `ticker_count * 0.3` seconds (assumes 95% cache hit rate after first run)

**API route patterns (consistent with existing routes.py):**
```python
@router.get("/api/universe/stats")
async def universe_stats(request: Request) -> JSONResponse:
    ...

@router.post("/api/universe/refresh")
async def universe_refresh(request: Request, background_tasks: BackgroundTasks) -> JSONResponse:
    ...
```

## Dependencies

- [ ] Task 003 (presets/filters) — `get_scan_universe()` for filtered counts
- [ ] Task 004 (watchlists) — watchlist CRUD functions
- [ ] Task 005 (pipeline) — scan accepts universe config
- [ ] Task 002 (refresh) — optional: refresh button only works if refresh module exists

## Effort Estimate

- Size: L
- Hours: 10-14
- Parallel: false (depends on backend tasks 3, 4, 5)

## Definition of Done

- [ ] Dashboard shows preset and sector selectors
- [ ] Selecting presets/sectors updates scan estimate and persists
- [ ] Watchlist management works in settings page
- [ ] Universe health stats display correctly
- [ ] Manual refresh button triggers and shows result
- [ ] All new routes return correct data
- [ ] UI is consistent with existing dashboard/settings styling
