---
name: Replace Ollama schema dump with example-based prompt hint
status: open
created: 2026-02-11T16:29:26Z
updated: 2026-02-11T16:32:44Z
github: https://github.com/jobu711/option_alpha_v2/issues/31
depends_on: []
parallel: true
conflicts_with: [32]
---

# Task: Replace Ollama schema dump with example-based prompt hint

## Description
The `OllamaClient.complete()` method appends a full Pydantic `model_json_schema()` dump as a structured output hint. The llama3.1:8b model echoes this abstract schema verbatim instead of generating a response, causing validation errors. Replace the schema dump with a `_build_example_hint()` helper that generates concrete JSON examples from model fields.

## Acceptance Criteria
- [ ] New `_build_example_hint(response_model)` function in `src/option_alpha/ai/clients.py`
- [ ] Helper iterates `model_fields` and generates placeholder values by type (str→"...", int→1, list[str]→["example"], Optional[int]→5, enum→first value)
- [ ] Helper uses field defaults where available
- [ ] `OllamaClient.complete()` uses `_build_example_hint()` instead of `model_json_schema()`
- [ ] Prompt hint does NOT contain `"description"`, `"properties"`, or `"type": "object"`
- [ ] Prompt hint contains a concrete JSON example like: `{"role": "bull", "analysis": "...", ...}`
- [ ] `ClaudeClient` is NOT modified (it handles schemas correctly)

## Technical Details
- **File:** `src/option_alpha/ai/clients.py`
- **Replace lines 139-151** in `OllamaClient.complete()`:
  - Remove `schema = response_model.model_json_schema()`
  - Remove the schema_hint that dumps `json.dumps(schema, indent=2)`
  - Add call to `_build_example_hint(response_model)` instead
- **New helper** `_build_example_hint(response_model: type[BaseModel]) -> str`:
  - Use `response_model.model_fields` to iterate fields
  - Map field annotation types to placeholder values
  - Handle: `str`, `int`, `float`, `bool`, `list[str]`, `Optional[T]`, `Enum` subclasses, `datetime`
  - Use `field.default` when it's a concrete value (not `PydanticUndefined`)
  - Return formatted prompt: `"\n\nRespond with a JSON object like this example:\n{json_example}"`
- Expected outputs:
  - `AgentResponse` → `{"role": "bull", "analysis": "Your analysis here", "key_points": ["point 1"], "conviction": 7}`
  - `TradeThesis` → `{"symbol": "TICKER", "direction": "bullish", "conviction": 7, "entry_rationale": "...", "risk_factors": ["risk 1"], "recommended_action": "Buy TICKER 100C 30DTE"}`

## Dependencies
- [ ] None — standalone code change in clients.py

## Effort Estimate
- Size: S
- Hours: 1
- Parallel: true (independent of task 30)

## Definition of Done
- [ ] `_build_example_hint()` implemented and generic
- [ ] `OllamaClient.complete()` uses new helper
- [ ] Existing tests pass
