---
name: Custom watchlist management
status: open
created: 2026-02-11T14:35:48Z
updated: 2026-02-11T14:41:55Z
github: https://github.com/jobu711/option_alpha_v2/issues/28
depends_on: [21]
parallel: true
conflicts_with: []
---

# Task: Custom watchlist management

## Description

Add a watchlist system that lets users create, manage, and use named lists of tickers alongside the built-in universe presets. Watchlists are stored in `watchlists.json` and can be selected as the scan universe (alone or combined with presets). Includes ticker validation against yfinance and integration with `get_scan_universe()` via the `extra_tickers` parameter.

## Acceptance Criteria

- [ ] `watchlists.py` module created in `src/option_alpha/data/`
- [ ] `watchlists.json` file format: `{"watchlists": {"name": ["SYM", ...]}, "active_watchlist": "name"|null}`
- [ ] CRUD functions: `create_watchlist(name, tickers)`, `get_watchlist(name)`, `update_watchlist(name, tickers)`, `delete_watchlist(name)`, `list_watchlists()`
- [ ] `get_active_watchlist()` returns tickers from the active watchlist (or empty list if none)
- [ ] Ticker validation: `validate_tickers(symbols)` checks existence via yfinance, returns valid/invalid split
- [ ] Watchlist names must be kebab-case, 1-50 chars
- [ ] Active watchlist tickers are merged into `get_scan_universe()` via `extra_tickers`
- [ ] Watchlist file auto-created on first write if it doesn't exist
- [ ] Max 20 watchlists, max 200 tickers per watchlist (configurable)

## Technical Details

**Files to create:**
- `src/option_alpha/data/watchlists.py`

**Watchlist storage pattern (mirrors config.py):**
```python
WATCHLIST_FILE = Path("watchlists.json")

def _load_watchlists() -> dict:
    if WATCHLIST_FILE.exists():
        return json.loads(WATCHLIST_FILE.read_text())
    return {"watchlists": {}, "active_watchlist": None}

def _save_watchlists(data: dict) -> None:
    WATCHLIST_FILE.write_text(json.dumps(data, indent=2))
```

**Integration with universe:**
- `get_scan_universe()` in Task 003 accepts `extra_tickers` param
- Pipeline calls: `extra = get_active_watchlist()` then passes to `get_scan_universe(extra_tickers=extra)`

**Ticker validation:**
- Use `yf.Tickers(symbols).tickers` to batch-validate existence
- Check `ticker.options` for optionability (warn but allow non-optionable tickers in watchlists)

## Dependencies

- [ ] Task 001 (universe data store) — needs universe system in place
- [ ] Task 003 (presets/filters) — `get_scan_universe()` must accept `extra_tickers` param
- [ ] yfinance (already a dependency)

## Effort Estimate

- Size: S
- Hours: 4-6
- Parallel: true (can develop alongside Tasks 2, 3 after Task 1 completes)

## Definition of Done

- [ ] CRUD operations work: create, read, update, delete, list
- [ ] Active watchlist tickers merge into scan universe
- [ ] Ticker validation identifies invalid symbols
- [ ] File persistence works across app restarts
- [ ] Unit tests cover all CRUD operations and edge cases
