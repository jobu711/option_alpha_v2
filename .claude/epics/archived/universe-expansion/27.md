---
name: Universe presets and sector filters
status: open
created: 2026-02-11T14:35:48Z
updated: 2026-02-11T14:41:55Z
github: https://github.com/jobu711/option_alpha_v2/issues/27
depends_on: [21]
parallel: true
conflicts_with: [21]
---

# Task: Universe presets and sector filters

## Description

Add preset-based and sector-based filtering to the universe system. Implement `get_scan_universe()` in `universe.py` that accepts preset names (sp500, midcap, smallcap, etfs, full) and sector filters (11 GICS sectors), returning the filtered ticker list. Add corresponding settings fields to `config.py` so selections persist across sessions. Presets are union-combined (S&P 500 + ETFs = both), sectors are intersection-filtered (S&P 500 AND Technology = large-cap tech only).

## Acceptance Criteria

- [ ] `get_scan_universe(presets, sectors)` function added to `universe.py`
- [ ] Presets defined: `sp500` (large-cap ~500), `midcap` (~600), `smallcap` (~900), `etfs`, `full` (~3,000)
- [ ] `sp500` preset maps to `market_cap_tier == "large"` and `asset_type == "stock"`
- [ ] Multiple presets combine via union (e.g., sp500 + etfs returns both sets)
- [ ] Sector filter intersects with preset results (e.g., sp500 + Technology = large-cap tech stocks)
- [ ] 11 GICS sectors supported: Technology, Healthcare, Financials, Consumer Discretionary, Consumer Staples, Industrials, Energy, Materials, Utilities, Real Estate, Communication Services
- [ ] Empty sectors list means "all sectors" (no filtering)
- [ ] `universe_presets` and `universe_sectors` fields added to `Settings` in `config.py`
- [ ] Default preset is `["full"]`, default sectors is `[]` (all)
- [ ] Settings persist via `config.json` save/load

## Technical Details

**Files to modify:**
- `src/option_alpha/data/universe.py` — Add `get_scan_universe()`, preset/sector filter logic
- `src/option_alpha/config.py` — Add `universe_presets: list[str]` and `universe_sectors: list[str]`

**Preset mapping logic:**
```python
PRESET_FILTERS = {
    "sp500": lambda t: t["market_cap_tier"] == "large" and t["asset_type"] == "stock",
    "midcap": lambda t: t["market_cap_tier"] == "mid" and t["asset_type"] == "stock",
    "smallcap": lambda t: t["market_cap_tier"] in ("small", "micro") and t["asset_type"] == "stock",
    "etfs": lambda t: t["asset_type"] == "etf",
    "full": lambda t: True,
}
```

**`get_scan_universe()` signature:**
```python
def get_scan_universe(
    presets: list[str] | None = None,
    sectors: list[str] | None = None,
    extra_tickers: list[str] | None = None,
    settings: Settings | None = None,
) -> list[str]:
```

## Dependencies

- [ ] Task 001 (universe data store) — needs `load_universe_data()` with sector/market_cap_tier fields
- [ ] No external dependencies

## Effort Estimate

- Size: S
- Hours: 4-6
- Parallel: true (can develop alongside Tasks 2, 4 after Task 1 completes)

## Definition of Done

- [ ] `get_scan_universe(["sp500"])` returns ~500 large-cap stock tickers
- [ ] `get_scan_universe(["sp500", "etfs"])` returns large-caps + ETFs
- [ ] `get_scan_universe(["full"], sectors=["Technology"])` returns only tech tickers
- [ ] `get_scan_universe()` with defaults returns full universe
- [ ] Config fields persist via save/load cycle
- [ ] Unit tests cover all preset/sector combinations
