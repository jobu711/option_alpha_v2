---
name: Add full regeneration mode
status: open
created: 2026-02-12T13:08:06Z
updated: 2026-02-12T13:15:04Z
github: https://github.com/jobu711/option_alpha_v2/issues/56
depends_on: [60]
parallel: true
conflicts_with: []
---

# Task: Add full regeneration mode

## Description
Add a `regenerate` parameter to `refresh_universe()` that controls whether to do a full SEC EDGAR rebuild (regenerate=True) or just validate/prune existing tickers (regenerate=False). Wire the parameter to the existing `POST /api/universe/refresh` endpoint via a `?regenerate=true` query parameter.

## Acceptance Criteria
- [ ] `refresh_universe()` accepts `regenerate: bool = False` parameter
- [ ] When `regenerate=True`: full pipeline runs (SEC EDGAR fetch → optionability → OI validation → enrichment → write)
- [ ] When `regenerate=False`: loads existing `universe_data.json` stock tickers, re-validates optionability + OI, removes failures, re-enriches metadata, writes back
- [ ] `POST /api/universe/refresh` accepts optional `regenerate` query param (default false)
- [ ] API response includes `mode: "regenerate"` or `mode: "validate"` to indicate which path ran
- [ ] Validation-only mode is significantly faster since it skips SEC EDGAR fetch and only checks existing tickers

## Technical Details
- File: `src/option_alpha/data/universe_refresh.py` — add `regenerate` param to `refresh_universe()` and `_do_refresh()`
- File: `src/option_alpha/web/routes.py` — modify `universe_refresh()` route to pass query param
- In validate-only mode: load current stock tickers from `universe_data.json`, run them through `_validate_optionability()` and `_validate_open_interest()`, then `_enrich_metadata()` on survivors
- This naturally handles delisted tickers: they'll fail optionability or OI checks and be removed

## Dependencies
- [ ] Task 60 (OI validation function must exist)

## Effort Estimate
- Size: S
- Hours: 3
- Parallel: true (can run alongside tasks 3 and 5 after task 2)

## Definition of Done
- [ ] Both regenerate and validate-only modes work
- [ ] API endpoint wired up
- [ ] Validate-only mode removes stale tickers
