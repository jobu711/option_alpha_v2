---
name: Backend-aware config defaults
status: open
created: 2026-02-13T12:43:00Z
updated: 2026-02-13T12:46:59Z
github: https://github.com/jobu711/option_alpha_v2/issues/72
depends_on: []
parallel: true
conflicts_with: []
---

# Task: Backend-aware config defaults

## Description

Add a `get_effective_ai_settings()` helper to `config.py` that returns backend-appropriate AI settings. When `ai_backend == "ollama"`, return conservative defaults (concurrency=1, longer timeouts, fewer retries). When `ai_backend == "claude"`, return current aggressive defaults. Users who explicitly set values in `config.json` override the effective defaults.

This is the foundational change that all other tasks build on — the debate runner (Task #75) will call this helper instead of reading raw config fields.

## Acceptance Criteria

- [ ] New `get_effective_ai_settings()` function in `config.py` returns a dict of effective AI settings
- [ ] Ollama defaults: `ai_debate_concurrency=1`, `ai_per_ticker_timeout=180`, `ai_request_timeout=120`, `ai_retry_delays=[2.0, 4.0]`
- [ ] Claude defaults: `ai_debate_concurrency=3`, `ai_per_ticker_timeout=60`, `ai_request_timeout=30`, `ai_retry_delays=[1.0, 2.0, 4.0]`
- [ ] Explicit user overrides in `config.json` take precedence over backend defaults
- [ ] Existing `Settings` field defaults remain unchanged (backward compatible)
- [ ] Unit tests for `get_effective_ai_settings()` with both backends and override scenarios

## Technical Details

### Implementation Approach

Add a method or standalone function that takes a `Settings` instance and returns effective values:

```python
def get_effective_ai_settings(settings: Settings) -> dict:
    """Return backend-appropriate AI settings, respecting user overrides."""
    # Define backend-specific defaults
    OLLAMA_DEFAULTS = {
        "ai_debate_concurrency": 1,
        "ai_per_ticker_timeout": 180,
        "ai_request_timeout": 120,
        "ai_retry_delays": [2.0, 4.0],
    }
    CLAUDE_DEFAULTS = {
        "ai_debate_concurrency": 3,
        "ai_per_ticker_timeout": 60,
        "ai_request_timeout": 30,
        "ai_retry_delays": [1.0, 2.0, 4.0],
    }
    # Pick base defaults by backend
    # Apply user overrides from config.json if they differ from Settings field defaults
    ...
```

The key challenge is detecting whether a user explicitly set a value vs relying on the field default. Approach: compare against the `Settings` class field defaults — if the value matches the Pydantic field default, treat it as "not explicitly set" and apply the backend-specific default instead.

### Files Affected
- `src/option_alpha/config.py` — Add function + backend default dicts

## Dependencies
- [ ] None — this is a standalone config change

## Effort Estimate
- Size: S
- Parallel: true
