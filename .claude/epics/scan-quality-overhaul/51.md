---
name: Wire scoring weights, composite mapping, and enhanced direction signal
status: open
created: 2026-02-12T11:13:23Z
updated: 2026-02-12T11:15:00Z
github: https://github.com/jobu711/option_alpha_v2/issues/51
depends_on: [50]
parallel: false
conflicts_with: []
---

# Task: Wire scoring weights, composite mapping, and enhanced direction signal

## Description
Integrate the 8 new indicators into the scoring pipeline. Update default weights in config, add composite weight mapping, update normalizer inversion set, and enhance `determine_direction()` with ADX confirmation to reduce false neutral signals.

## Acceptance Criteria
- [ ] `DEFAULT_SCORING_WEIGHTS` in config.py has 14 entries summing to 1.0
- [ ] `INDICATOR_WEIGHT_MAP` in composite.py maps all 7 scored indicators (supertrend excluded)
- [ ] `keltner_width` added to normalizer default invert set
- [ ] `determine_direction()` uses ADX: ADX < 20 biases NEUTRAL, ADX > 25 strengthens conviction
- [ ] Existing config.json files without new keys load successfully with defaults
- [ ] All related tests pass

## Technical Details

### Files to modify
- `src/option_alpha/config.py` — update `DEFAULT_SCORING_WEIGHTS`
- `src/option_alpha/scoring/composite.py` — update `INDICATOR_WEIGHT_MAP`, update `determine_direction()`, add `adx` import
- `src/option_alpha/scoring/normalizer.py` — add `keltner_width` to default invert set
- `tests/test_composite.py` — tests for weights, direction with ADX
- `tests/test_config.py` — test weight sum, backward compat
- `tests/test_normalizer.py` — test keltner_width inversion

### config.py changes
Replace `DEFAULT_SCORING_WEIGHTS` with PRD values:
| Key | Weight | Notes |
|-----|--------|-------|
| bb_width | 0.12 | existing, reduced |
| atr_percentile | 0.08 | existing, reduced |
| rsi | 0.08 | existing, reduced |
| obv_trend | 0.06 | existing, reduced |
| sma_alignment | 0.08 | existing, reduced |
| relative_volume | 0.06 | existing, reduced |
| catalyst_proximity | 0.15 | existing, reduced |
| stoch_rsi | 0.06 | new |
| williams_r | 0.04 | new |
| roc | 0.04 | new |
| adx | 0.08 | new |
| keltner_width | 0.05 | new |
| vwap_deviation | 0.05 | new |
| ad_trend | 0.05 | new |

Total: 1.00

### composite.py changes
Add to `INDICATOR_WEIGHT_MAP`:
```python
"stoch_rsi": "stoch_rsi",
"williams_r": "williams_r",
"roc": "roc",
"adx": "adx",
"keltner_width": "keltner_width",
"vwap_deviation": "vwap_deviation",
"ad_trend": "ad_trend",
```

Update `determine_direction()`:
- Import `adx` from indicators
- Compute ADX value
- ADX < 20: return NEUTRAL regardless of RSI/SMA (weak trend)
- ADX > 25: proceed with existing RSI+SMA logic (confirmed trend)
- 20 <= ADX <= 25: use existing logic unchanged (transition zone)

### normalizer.py changes
Add `"keltner_width"` to default invert set (lower = tighter = better for squeeze).

## Dependencies
- [ ] Task 001 must be complete (indicators must exist)

## Effort Estimate
- Size: M
- Hours: 3-4
- Parallel: false — depends on Task 001

## Definition of Done
- [ ] Config weights updated and sum verified to 1.0
- [ ] INDICATOR_WEIGHT_MAP updated with all 7 new entries
- [ ] determine_direction() uses ADX
- [ ] Normalizer inverts keltner_width
- [ ] Tests written and passing
- [ ] `pytest tests/test_composite.py tests/test_config.py tests/test_normalizer.py` passes
