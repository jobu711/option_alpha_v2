---
name: Implement 8 new technical indicators with unit tests
status: closed
created: 2026-02-12T11:13:23Z
updated: 2026-02-12T11:15:00Z
github: https://github.com/jobu711/option_alpha_v2/issues/50
depends_on: []
parallel: true
conflicts_with: []
---

# Task: Implement 8 new technical indicators with unit tests

## Description
Add 8 new indicator functions to `src/option_alpha/scoring/indicators.py` following the existing pure pandas/numpy pattern. Update `compute_all_indicators()` to include them. Write comprehensive unit tests for each indicator in `tests/test_indicators.py`.

## Acceptance Criteria
- [ ] 8 new indicator functions implemented: `vwap_deviation`, `ad_trend`, `stoch_rsi`, `williams_r`, `roc`, `keltner_width`, `adx`, `supertrend`
- [ ] Each function calls `_validate_ohlcv(df)` and checks minimum row requirements
- [ ] Each function returns `float("nan")` on insufficient data
- [ ] `compute_all_indicators()` returns dict with 14 keys (6 existing + 8 new)
- [ ] Unit tests pass for all 8 new indicators
- [ ] No external TA library dependencies added (pure pandas/numpy)

## Technical Details

### Files to modify
- `src/option_alpha/scoring/indicators.py` — add functions, MIN_ROWS constants, update `compute_all_indicators()`
- `tests/test_indicators.py` — add test classes/functions for each new indicator

### New indicator specifications

**Volume-based:**
1. `vwap_deviation(df, period=20)` — % distance from VWAP. Daily approx: typical_price = (H+L+C)/3, VWAP = cumsum(TP*V)/cumsum(V) over period. Return (close - vwap) / vwap * 100. MIN_ROWS_VWAP = 20.
2. `ad_trend(df, period=20)` — A/D line slope normalized like `obv_trend`. A/D = cumsum(CLV * Volume) where CLV = ((C-L)-(H-C))/(H-L). Slope via polyfit, normalize by mean abs. MIN_ROWS_AD = 20.

**Momentum:**
3. `stoch_rsi(df, rsi_period=14, stoch_period=14)` — Apply stochastic formula to RSI values: (RSI - min(RSI,n)) / (max(RSI,n) - min(RSI,n)) * 100. MIN_ROWS_STOCH_RSI = 28.
4. `williams_r(df, period=14)` — (highest_high - close) / (highest_high - lowest_low) * -100. Range: -100 to 0. MIN_ROWS_WILLIAMS = 14.
5. `roc(df, period=12)` — (close - close[n]) / close[n] * 100. MIN_ROWS_ROC = 13.

**Volatility:**
6. `keltner_width(df, period=20, atr_mult=1.5)` — (upper - lower) / middle where middle = EMA(close, period), bands = middle +/- atr_mult * ATR(period). MIN_ROWS_KELTNER = 20.

**Trend/Structure:**
7. `adx(df, period=14)` — +DI/-DI from smoothed +DM/-DM and ATR. DX = |+DI - -DI| / (+DI + -DI) * 100. ADX = Wilder's smoothed DX. Returns 0-100. MIN_ROWS_ADX = 28.
8. `supertrend(df, period=10, multiplier=3.0)` — Returns 1.0 (bullish) or -1.0 (bearish). Upper band = HL2 + mult*ATR, lower = HL2 - mult*ATR. Flip on price cross. MIN_ROWS_SUPERTREND = 11.

### Test pattern per indicator
Follow existing pattern in `test_indicators.py`:
- Insufficient data returns NaN
- Known synthetic OHLCV data produces expected value (within tolerance)
- Missing OHLCV columns raises ValueError
- Edge cases (zero volume, flat prices, etc.)

## Dependencies
- [ ] No task dependencies — this is the foundation task
- [ ] pandas and numpy (already in project)

## Effort Estimate
- Size: L
- Hours: 6-8
- Parallel: true — no dependencies on other tasks

## Definition of Done
- [ ] Code implemented in indicators.py
- [ ] All 8 functions follow existing pattern (_validate_ohlcv, MIN_ROWS check, float return)
- [ ] compute_all_indicators() updated
- [ ] Tests written and passing for all 8 indicators
- [ ] `pytest tests/test_indicators.py` passes
