---
name: End-to-end integration validation and backward compatibility
status: closed
created: 2026-02-12T11:13:23Z
updated: 2026-02-12T11:15:00Z
github: https://github.com/jobu711/option_alpha_v2/issues/54
depends_on: [50, 51, 52, 53]
parallel: false
conflicts_with: []
---

# Task: End-to-end integration validation and backward compatibility

## Description
Verify the full pipeline works end-to-end with the expanded indicator set. Confirm backward compatibility with existing config files. Run the complete test suite to catch any regressions.

## Acceptance Criteria
- [ ] `compute_all_indicators()` returns 14-key dict for sufficient data
- [ ] `score_universe()` produces valid TickerScore objects with 13+ breakdown entries
- [ ] `build_context()` produces enriched context under 4000 tokens
- [ ] `determine_direction()` correctly uses ADX in decision logic
- [ ] Settings.load() with old config (missing new keys) works with defaults
- [ ] Settings.save() / Settings.load() round-trips with all 14 weights
- [ ] Full test suite passes: `pytest tests/`
- [ ] No regressions in existing tests

## Technical Details

### Files to modify
- `tests/test_integration.py` — add/update integration tests
- `tests/test_pipeline.py` — update mocks if needed for new indicator count

### Integration test scenarios

**Backward compatibility:**
- Create Settings from JSON missing new weight keys → verify defaults applied
- Save settings with all 14 weights → load → verify round-trip

**Full scoring path:**
- Create synthetic 200-row OHLCV DataFrame
- Run `compute_all_indicators()` → verify 14 keys, all non-NaN
- Run `score_universe()` with 5+ tickers → verify composite scores in [0, 100]
- Verify breakdown has entries for all weighted indicators

**Direction signal:**
- Test with synthetic data producing ADX < 20 → verify NEUTRAL
- Test with synthetic data producing ADX > 25 + bullish RSI/SMA → verify BULLISH
- Test transition zone 20-25 → verify existing logic applies

**Context enrichment:**
- Build context from scored ticker with options rec → verify all sections present
- Measure context length stays under 16000 chars

**Pipeline mock test:**
- Mock all external calls (yfinance, LLM)
- Run pipeline phases 1-2 (fetch + score) → verify new indicators flow through
- Verify PARTIAL checkpoint contains new breakdown entries

### Regression check
Run `pytest tests/ --tb=short` and verify zero failures beyond any known env-dependent tests.

## Dependencies
- [ ] All tasks 001-004 must be complete

## Effort Estimate
- Size: M
- Hours: 3-4
- Parallel: false — final validation task

## Definition of Done
- [ ] All integration tests written and passing
- [ ] Backward compatibility verified
- [ ] Full test suite passes: `pytest tests/`
- [ ] No regressions introduced
