---
name: Pipeline integration
status: open
created: 2026-02-13T21:15:40Z
updated: 2026-02-13T21:24:02Z
github: https://github.com/jobu711/option_alpha_v2/issues/87
depends_on: [86]
parallel: true
conflicts_with: []
---

# Task: Pipeline integration

## Description

Update the scan pipeline orchestrator to use the new database-backed universe instead of the hardcoded lists. This is a minimal change: swap the `get_full_universe()` import and call in `orchestrator.py` to use `get_active_universe()` from the new service layer. Ensure seeding runs automatically on first use and log the active ticker count.

## Acceptance Criteria

- [ ] Orchestrator imports `get_active_universe` from `data.universe_service` instead of `get_full_universe` from `data.universe`
- [ ] `_phase_data_fetch()` calls `get_active_universe(self.settings.db_path)` instead of `get_full_universe()`
- [ ] Active ticker count logged at scan start
- [ ] Auto-seeding triggers on first scan if universe tables are empty
- [ ] Pipeline produces identical results when all tickers are active (backward compatibility)
- [ ] Existing integration tests updated to work with DB-backed universe

## Technical Details

### Changes in `src/option_alpha/pipeline/orchestrator.py`

**Line 32** — Change import:
```python
# Before:
from option_alpha.data.universe import get_full_universe

# After:
from option_alpha.data.universe_service import get_active_universe
```

**Line ~207** in `_phase_data_fetch()` — Change call:
```python
# Before:
universe = get_full_universe()

# After:
universe = get_active_universe(self.settings.db_path)
```

The logging on line 208 (`logger.info("Universe: %d tickers", len(universe))`) already handles the count.

### Auto-seeding

`get_active_universe()` should call `seed_universe()` internally if the universe tables are empty, ensuring the pipeline works out of the box without any manual setup step.

### Test updates

Update `tests/test_integration.py` if it mocks `get_full_universe` — change mock target to `get_active_universe` from the new module path.

### Files affected
- `src/option_alpha/pipeline/orchestrator.py` (2-line change: import + call)
- `tests/test_integration.py` (mock target update if needed)

## Dependencies

- [ ] Task #86 (Universe service layer must exist)

## Effort Estimate

- Size: S
- Hours: 1-2
- Parallel: true (independent of Tasks 004, 005 after Task 002 completes)

## Definition of Done

- [ ] Orchestrator uses `get_active_universe()` from service layer
- [ ] Pipeline runs successfully with DB-backed universe
- [ ] `pytest tests/` passes (all existing + updated tests)
