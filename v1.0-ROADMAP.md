## Overview

An AI-powered local Python tool that scans all optionable stocks daily for catalyst-driven breakout setups, scores them using a consolidation/squeeze-weighted technical analysis system, then uses multi-agent LLM debate to produce trade theses and specific options contract recommendations (strike, expiration, direction) with full Greek analysis.

## Phases

### Phase 1: Project Foundation & Data Layer

**Goal**: Establish project scaffold, configuration system, and reliable data fetching with caching so all downstream phases have clean data to work with.
**Depends on**: None (first phase)
**Plans**: 4 plans
**Status**: Complete (2026-02-02)

**Requirements**: {}

**Deliverables:**
- Python package structure (`options_alpha/`)
- `pyproject.toml` with all dependencies
- Configuration system (Pydantic models, YAML/JSON config file)
- yfinance wrapper with abstraction layer
- Batch OHLCV download with threading
- Caching layer (parquet for OHLCV, JSON for other data)
- Curated ticker universe (3,000+ tickers)
- Pre-filter module (volume, price, optionability checks)
- Error handling with retry/backoff and structured logging

---

### Phase 2: Technical Scoring Engine

**Goal**: Calculate all technical indicators and produce a composite score with full transparency per ticker, so we can rank the universe by breakout potential.
**Depends on**: Phase 1 (data layer)
**Plans**: 4 plans
**Status**: Complete (2026-02-03)

**Deliverables:**
- Technical indicator module (BB width, ATR, RSI, OBV, SMA alignment, relative volume)
- Squeeze/consolidation detection (weighted composite of BB + ATR + volume signals)
- Scoring engine with configurable weights
- Normalization system (0-100 percentile rank per indicator)
- Per-indicator transparency (raw, normalized, weight, contribution stored per ticker)
- Ranked output: sorted list of tickers with composite scores

---

### Phase 3: Catalyst Detection

**Goal**: Integrate earnings calendar data and score catalyst proximity so that the composite score prioritizes stocks with upcoming catalysts.
**Depends on**: Phase 1 (data layer), Phase 2 (scoring engine)
Plans:
— Pydantic models for catalyst data and earnings date fetcher
— CatalystScorer with exponential decay (TDD)
- Scoring engine integration and tests

**Deliverables:**
- Earnings calendar fetcher (next earnings date per ticker via yfinance)
- Catalyst proximity scorer (3/7/14 day windows with configurable scoring)
- IV crush warning flag for earnings within 7 days
- Integration into composite scoring engine (catalyst weight = 0.25)

---

### Phase 4: Options Analysis & Contract Recommendation

**Goal**: Fetch options chains for top candidates, calculate Greeks, filter by liquidity, and recommend specific contracts (strike, expiration, direction) with full Greek display.
**Depends on**: Phase 1 (data layer), Phase 2 (scoring for top candidates)

Plans:
— Options models, risk-free rate fetcher, options chain fetcher
— Greek calculations with py_vollib, liquidity filtering
— Contract selector (delta-based), risk/reward calculator
— OptionsAnalyzer orchestrator and comprehensive tests

**Deliverables:**
- Options chain fetcher for top 50 candidates
- Greek calculator (delta, gamma, theta, vega via py_vollib with manual fallback)
- Liquidity filter (OI > 100, spread < 10% mid, volume > 0)
- Contract recommendation engine (strike selection, 30-60 DTE targeting, direction from technical thesis)
- Risk-free rate fetcher (FRED API or configurable default)

**Note:** OPT-2 (IV percentile) deferred — yfinance lacks historical IV data needed for percentile ranking.

---

### Phase 5: AI Multi-Agent Debate

**Goal**: Connect to Ollama, implement bull/bear/risk agent debate for top 10 candidates, produce structured trade theses with conviction scores.
**Depends on**: Phase 4 (needs scoring + options data for prompts)
**Requirements**: AI-1, AI-2, AI-3, AI-4, AI-5, AI-6, AI-7, AI-8

Plans:
— AI module foundation (models, client, config)
— Context builder and system prompts
— Bull, Bear, Risk agents with fallback
— Debate orchestrator and test suite

**Deliverables:**
- Ollama client integration with connection verification
- Bull agent (system prompt + structured analysis)
- Bear agent (counter-arguments given bull thesis)
- Risk agent (synthesis, conviction 1-10, trade/no-trade)
- Pydantic models for structured output (TradeThesis, AgentResponse)
- Context builder (curate ~2000 token prompt from scoring + options data)
- Retry/fallback on parse failure (3 retries, plain-text fallback)
- Top-10 candidate analysis pipeline

---

### Phase 6: Dashboard

**Goal**: Build the morning dashboard that displays ranked candidates, score breakdowns, options recommendations, and AI debate results in a clear, scannable format.
**Depends on**: Phase 5 (all data must be available for display)

Plans:
- Dashboard foundation (app, state, styles, data loading)
- Visualization components (gauge, progress bars, price chart)
- Card grid and header components
- Detail panel, debate view, Greeks table
- Integration and visual verification

**Deliverables:**
- app entry point
- Ranked candidates table (sortable, color-coded by direction)
- Score breakdown visualization (per-indicator contribution bars)
- Ticker drill-down panel (all indicators, options chain, Greeks, AI debate)
- AI debate display (bull/bear/risk with formatting)
- Market regime header (VIX, SPY trend)
- Data freshness indicator
- Color coding system (green/red/yellow)

---

### Phase 7: Pipeline Integration & Polish

**Goal**: Wire the full end-to-end pipeline, progress reporting, and error recovery so the tool works reliably as a daily workflow.
**Depends on**: All prior phases
Plans:
- Pipeline orchestrator with phase execution and error recovery
- dashboard data wiring
- Pipeline tests, smoke test, and README

**Deliverables:**
- Main orchestrator (runs all phases in sequence)
- - Progress reporting (phase-by-phase logging with timing)
- Error recovery (partial failure handling, continue with available data)
- End-to-end smoke test
- README with setup instructions

---

## Phase Dependency Graph

```
Phase 1 (Foundation)
    |---> Phase 2 (Technical Scoring)
    |        |---> Phase 3 (Catalysts)
    |        \---> Phase 4 (Options) <-- Phase 3
    |                 \---> Phase 5 (AI Debate)
    |                          \---> Phase 6 (Dashboard)
    |                                    \---> Phase 7 (Integration)
    \----------------------------------------------------/
```

## Milestone Summary

**Key Decisions:**
- hatchling build backend with src-layout for modern Python packaging
- pandas-ta-classic for technical indicators (handles edge cases)
- Weighted geometric mean for composite scoring (penalizes poor scores)
- Exponential decay for catalyst proximity scoring
- py_vollib for BSM Greek calculations with dividend support
- instructor library for structured LLM output with retry
- Sequential Bull -> Bear -> Risk debate flow
- Conservative defaults (no_trade, conviction=3) on parse failures
- Dataclass-based PhaseResult for lightweight pipeline tracking
- Mock-based testing strategy for deterministic CI


